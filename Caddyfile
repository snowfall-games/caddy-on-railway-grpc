{
	auto_https off
	servers {
		protocols h1 h2c h2
	}
}

horde.snowfall.games:{$PORT} {
	respond /health "Caddy is working" 200
	
	# More robust gRPC detection
	@grpc {
		header Content-Type application/grpc*
		protocol grpc
	}
	
	handle @grpc {
		reverse_proxy snowfall-horde.railway.internal:5002 {
			transport http {
				versions h2c 2
			}
		}
	}

	# Fallback HTTP
	handle {
		reverse_proxy snowfall-horde.railway.internal:5000
	}
}