:{$PORT} {
	# Terminate TLS using the Cloudflare Origin cert
	tls /config/certs/cf-origin.crt /config/certs/cf-origin.key

	log {
		output stdout
		format console
		level DEBUG
	}

	# gRPC matcher - test exact match
	@grpc {
		header Content-Type "application/grpc"
	}

	route {
		# Health check endpoint
		handle /health {
			respond "OK" 200
		}

		# Debug: Test if gRPC matcher works
		handle @grpc {
			respond "GRPC MATCH FOUND - Content-Type: {http.request.header.content-type}" 200
		}

		# Everything else â†’ HTTP upstream
		handle {
			reverse_proxy http://{$HORDE_HOST}:5000
		}
	}
}
